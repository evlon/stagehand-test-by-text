version: "1.0"
rules:
  - name: "goto_url"
    patterns:
      - "打开|{url}"
      - "访问|{url}"
      - "导航到|{url}"
      - "打开|{lebel}|{url}"
      - "访问|{lebel}|{url}"
      - "导航到|{lebel}|{url}"
    template: |
      await page.goto('{url}');    
    validation:
      required: ["url"]

  - name: "input_action"
    patterns:
      - "在{field}中输入{value}"
    template: "await stagehand.act('在 {field} 中输入 {value}')"
    validation:
      required: ["field", "value"]

  - name: "assertion"
    patterns:
      - "检查|包含|{text}"
    template: |
      {
        const result = await stagehand.extract(
          "检查页面是否包含文本 {text}",
          z.object({ found: z.boolean() })
        );
        if (!result.found) {
          throw new Error(`未找到文本: ${'{text}'}`);
        }
      }
 
 
  - name: "wait_ms"
    patterns:
      - "等待{ms}毫秒"
      - "等待{ms}ms"
    template: "await new Promise(r => setTimeout(r, {ms}))"
    validation:
      required: ["ms"]

  - name: "screenshot"
    patterns:
      - "截图|保存为|{imagefilename}"
      - "截屏|保存为|{imagefilename}"
      - "保存截图|{imagefilename}"
    template: |
      // 3. 调用 screenshot() 方法
      // 它返回一个 Promise<Buffer>
      // { fullPage: true } 可选，用于捕获整个可滚动页面，默认为 false (只截取视口)
      await page.screenshot({ path: `results/{imagefilename}.png`, fullPage: true });
      const screenshotBuffer = await page.screenshot({ 
            fullPage: true 
      });
      // 4. 定义保存路径和文件名
      const filePath = path.join(process.cwd(), "results/screenshots/{imagefilename}.png");        
      // 5. 使用 fs.writeFileSync (同步) 或 fs.writeFile (异步) 将 Buffer 写入文件
      fs.writeFileSync(filePath, screenshotBuffer);
    validation:
      required: ["imagefilename"]

  - name: "default_agent"
    patterns:
      - "运行|{action}"
    template: "await stagehand.agent('{action}')"
    validation:
      required: ["action"]
 
  - name: "default_act"
    patterns:
      - "{action}"
    template: "await stagehand.act('{action}')"
    validation:
      required: ["action"]
